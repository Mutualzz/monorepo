#!/bin/sh

# Generate changelog
pnpm run gen-changelog

CHANGELOG_FILE="CHANGELOG.md"

# Check if file exists
if [ ! -f "$CHANGELOG_FILE" ]; then
  echo "$CHANGELOG_FILE not found, skipping."
  exit 0
fi

# Check if file is empty
if [ ! -s "$CHANGELOG_FILE" ]; then
  echo "$CHANGELOG_FILE is empty, skipping."
  exit 0
fi

# Check if file has changes compared to HEAD (including submodules)
if ! git diff --quiet --ignore-submodules=none HEAD -- "$CHANGELOG_FILE"; then
  git add "$CHANGELOG_FILE"
  echo "$CHANGELOG_FILE updated and staged."
else
  echo "$CHANGELOG_FILE unchanged, skipping."
fi
